<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Snapshot tests (aka golden tests) are similar to unit tests except that the
expected result is stored in a separate file that is managed by testthat.
Snapshot tests are useful for when the expected value is large, or when
the intent of the code is something that can only be verified by a human
(e.g. this is a useful error message). Learn more in
vignette("snapshotting").
expect_snapshot() captures all messages, warnings, errors, and
output from code.
expect_snapshot_output() captures just output printed to the console.
expect_snapshot_error() captures an error message and
optionally checks its class.
expect_snapshot_warning() captures a warning message and
optionally checks its class.
expect_snapshot_value() captures the return value.


(These functions supersede verify_output(), expect_known_output(),
expect_known_value(), and expect_known_hash().)'><title>Snapshot testing — expect_snapshot • testthat</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.2/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.2/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Snapshot testing — expect_snapshot"><meta property="og:description" content='Snapshot tests (aka golden tests) are similar to unit tests except that the
expected result is stored in a separate file that is managed by testthat.
Snapshot tests are useful for when the expected value is large, or when
the intent of the code is something that can only be verified by a human
(e.g. this is a useful error message). Learn more in
vignette("snapshotting").
expect_snapshot() captures all messages, warnings, errors, and
output from code.
expect_snapshot_output() captures just output printed to the console.
expect_snapshot_error() captures an error message and
optionally checks its class.
expect_snapshot_warning() captures a warning message and
optionally checks its class.
expect_snapshot_value() captures the return value.


(These functions supersede verify_output(), expect_known_output(),
expect_known_value(), and expect_known_hash().)'><meta property="og:image" content="https://testthat.r-lib.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="testthat.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">testthat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.4.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/custom-expectation.html">Custom expectations</a>
    <a class="dropdown-item" href="../articles/parallel.html">Running tests in parallel</a>
    <a class="dropdown-item" href="../articles/skipping.html">Skipping tests</a>
    <a class="dropdown-item" href="../articles/snapshotting.html">Snapshot tests</a>
    <a class="dropdown-item" href="../articles/test-fixtures.html">Test fixtures</a>
    <a class="dropdown-item" href="../articles/third-edition.html">testthat 3e</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/10/testthat-3-1/">Version 3.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/10/testthat-3-0-0/">Version 3.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/11/testthat-2-3-0/">Version 2.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/04/testthat-2-1-0/">Version 2.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2017/12/testthat-2-0-0/">Version 2.0.0</a>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2016/04/29/testthat-1-0-0/">Version 1.0.0</a>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2015/05/29/testthat-0-10-0/">Version 0.10.0</a>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2014/09/23/testthat-0-9/">Version 0.9.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/testthat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Snapshot testing</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/testthat/blob/HEAD/R/snapshot.R" class="external-link"><code>R/snapshot.R</code></a></small>
      <div class="d-none name"><code>expect_snapshot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Snapshot tests (aka golden tests) are similar to unit tests except that the
expected result is stored in a separate file that is managed by testthat.
Snapshot tests are useful for when the expected value is large, or when
the intent of the code is something that can only be verified by a human
(e.g. this is a useful error message). Learn more in
<code><a href="../articles/snapshotting.html">vignette("snapshotting")</a></code>.</p><ul><li><p><code>expect_snapshot()</code> captures all messages, warnings, errors, and
output from code.</p></li>
<li><p><code>expect_snapshot_output()</code> captures just output printed to the console.</p></li>
<li><p><code>expect_snapshot_error()</code> captures an error message and
optionally checks its class.</p></li>
<li><p><code>expect_snapshot_warning()</code> captures a warning message and
optionally checks its class.</p></li>
<li><p><code>expect_snapshot_value()</code> captures the return value.</p></li>
</ul><p>(These functions supersede <code><a href="verify_output.html">verify_output()</a></code>, <code><a href="expect_known_output.html">expect_known_output()</a></code>,
<code><a href="expect_known_output.html">expect_known_value()</a></code>, and <code><a href="expect_known_output.html">expect_known_hash()</a></code>.)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">expect_snapshot</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  cran <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  error <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variant <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cnd_class <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">expect_snapshot_output</span><span class="op">(</span><span class="va">x</span>, cran <span class="op">=</span> <span class="cn">FALSE</span>, variant <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">expect_snapshot_error</span><span class="op">(</span><span class="va">x</span>, class <span class="op">=</span> <span class="st">"error"</span>, cran <span class="op">=</span> <span class="cn">FALSE</span>, variant <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">expect_snapshot_warning</span><span class="op">(</span><span class="va">x</span>, class <span class="op">=</span> <span class="st">"warning"</span>, cran <span class="op">=</span> <span class="cn">FALSE</span>, variant <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">expect_snapshot_value</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"json"</span>, <span class="st">"json2"</span>, <span class="st">"deparse"</span>, <span class="st">"serialize"</span><span class="op">)</span>,</span>
<span>  cran <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fu"><a href="compare.html">testthat_tolerance</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  variant <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>Code to evaluate.</p></dd>


<dt>cran</dt>
<dd><p>Should these expectations be verified on CRAN? By default,
they are not, because snapshot tests tend to be fragile because they
often rely on minor details of dependencies.</p></dd>


<dt>error</dt>
<dd><p>Do you expect the code to throw an error? The expectation
will fail (even on CRAN) if an unexpected error is thrown or the
expected error is not thrown.</p></dd>


<dt>transform</dt>
<dd><p>Optionally, a function to scrub sensitive or stochastic
text from the output. Should take a character vector of lines as input
and return a modified character vector as output.</p></dd>


<dt>variant</dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>If not-<code>NULL</code>, results will be saved in <code>_snaps/{variant}/{test.md}</code>,
so <code>variant</code> must be a single string of alphanumeric characters suitable
for use as a directory name.</p>
<p>You can variants to deal with cases where the snapshot output varies
and you want to capture and test the variations. Common use cases include
variations for operating system, R version, or version of key dependency.
Variants are an advanced feature. When you use them, you'll need to
carefully think about your testing strategy to ensure that all important
variants are covered by automated tests, and ensure that you have a way
to get snapshot changes out of your CI system and back into the repo.</p></dd>


<dt>cnd_class</dt>
<dd><p>Whether to include the class of messages,
warnings, and errors in the snapshot. Only the most specific
class is included, i.e. the first element of <code>class(cnd)</code>.</p></dd>


<dt>class</dt>
<dd><p>Class of expected error or warning. The expectation will
always fail (even on CRAN) if an error of this class isn't seen
when executing <code>x</code>.</p></dd>


<dt>style</dt>
<dd><p>Serialization style to use:</p><ul><li><p><code>json</code> uses <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">jsonlite::fromJSON()</a></code> and <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code>. This
produces the simplest output but only works for relatively simple
objects.</p></li>
<li><p><code>json2</code> uses <code><a href="https://rdrr.io/pkg/jsonlite/man/serializeJSON.html" class="external-link">jsonlite::serializeJSON()</a></code> and <code><a href="https://rdrr.io/pkg/jsonlite/man/serializeJSON.html" class="external-link">jsonlite::unserializeJSON()</a></code>
which are more verbose but work for a wider range of type.</p></li>
<li><p><code>deparse</code> uses <code><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse()</a></code>, which generates a depiction of the object
using R code.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code> produces a binary serialization of the object using
<code><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize()</a></code>. This is all but guaranteed to work for any R object,
but produces a completely opaque serialization.</p></li>
</ul></dd>


<dt>tolerance</dt>
<dd><p>Numerical tolerance: any differences (in the sense of
<code><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">base::all.equal()</a></code>) smaller than this value will be ignored.</p>
<p>The default tolerance is <code>sqrt(.Machine$double.eps)</code>, unless long doubles
are not available, in which case the test is skipped.</p></dd>


<dt>...</dt>
<dd><p>For <code>expect_snapshot_value()</code> only, passed on to
<code><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">waldo::compare()</a></code> so you can control the details of the comparison.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a></h2>
    

<p>The first time that you run a snapshot expectation it will run <code>x</code>,
capture the results, and record in <code>tests/testthat/snap/{test}.json</code>.
Each test file gets its own snapshot file, e.g. <code>test-foo.R</code> will get
<code>snap/foo.json</code>.</p>
<p>It's important to review the JSON files and commit them to git. They are
designed to be human readable, and you should always review new additions
to ensure that the salient information has been captured. They should also
be carefully reviewed in pull requests, to make sure that snapshots have
updated in the expected way.</p>
<p>On subsequent runs, the result of <code>x</code> will be compared to the value stored
on disk. If it's different, the expectation will fail, and a new file
<code>snap/{test}.new.json</code> will be created. If the change was deliberate,
you can approve the change with <code><a href="snapshot_accept.html">snapshot_accept()</a></code> and then the tests will
pass the next time you run them.</p>
<p>Note that snapshotting can only work when executing a complete test file
(with <code><a href="test_file.html">test_file()</a></code>, <code><a href="test_dir.html">test_dir()</a></code>, or friends) because there's otherwise
no way to figure out the snapshot path. If you run snapshot tests
interactively, they'll just display the current value.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

  </div></footer></body></html>

